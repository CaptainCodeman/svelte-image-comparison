var A=new WeakMap,P;function J(e,s){return P=P||new ResizeObserver(h=>{for(let r of h){let u=A.get(r.target);u&&u(r)}}),A.set(e,s),P.observe(e),{destroy(){P.unobserve(e),A.delete(e)}}}var j=(e,s)=>Math.hypot(e.x-s.x,e.y-s.y),B=(e,s)=>({x:(e.x+s.x)/2,y:(e.y+s.y)/2}),G=(e,s)=>({x:e.x-s.x,y:e.y-s.y}),K=.02,tt=120;function et(e,s){let h=window.devicePixelRatio,r=e.getContext("2d"),u=requestAnimationFrame,f,g,w,F,m,T,R,E=e.width=e.clientWidth*h,L=e.height=e.clientHeight*h,x,c=0,i={vx:0,vy:0,ts:0},p=new Map,d=[];function W(t){({width:g,height:w,render:F,padding:m,maxZoom:T,friction:R}={padding:0,maxZoom:16,friction:.97,...t}),f=Math.min(e.width/(g+m*h),e.height/(w+m*h)),r.resetTransform(),r.translate(e.width/2,e.height/2),r.scale(f,f),r.translate(-g/2,-w/2),Z(),x=v({x:e.width/2,y:e.height/2}),I()}W(s);let N=J(e,t=>{let n=t.contentRect,o=v({x:E/2,y:L/2}),a=r.getTransform();E=n.width*h,L=n.height*h,e.width=E,e.height=L,f=Math.min(e.width/(s.width+m*h),e.height/(s.height+m*h)),r.setTransform(a),x=v({x:E/2,y:L/2}),r.translate(x.x-o.x,x.y-o.y),c||C(performance.now())});function Y(t){for(;d.length&&t-d[0].t>tt;)d.shift()}function Q(t){let n=performance.now();Y(n),d.push({point:t,t:n})}function Z(){c&&(cancelAnimationFrame(c),c=0),i.vx=0,i.vy=0,d.length=0}function S(){let t=v({x:0,y:0}),n=v({x:e.width,y:e.height});t.x>g&&(r.translate(t.x-g,0),i.vx=-i.vx),t.y>w&&(r.translate(0,t.y-w),i.vy=-i.vy),n.x<0&&(r.translate(n.x,0),i.vx=-i.vx),n.y<0&&(r.translate(0,n.y),i.vy=-i.vy)}function q(t){t.stopPropagation(),e.setPointerCapture(t.pointerId);let n=z(t);p.set(t.pointerId,n),Z()}function b(t){if(t.stopPropagation(),e.releasePointerCapture(t.pointerId),p.delete(t.pointerId),p.size===0&&(Y(performance.now()),d.length>1)){let n=d[0],o=d[d.length-1],a=o.point.x-n.point.x,l=o.point.y-n.point.y,y=o.t-n.t;i={vx:a/y,vy:l/y,ts:performance.now()},I()}}function D(t){if(t.stopPropagation(),!p.has(t.pointerId))return;let n=z(t);switch(p.size){case 1:{let o=v(n);Q(o);let a=p.get(t.pointerId),l=G(o,v(a));x=o,k(l),I(),p.set(t.pointerId,n);break}case 2:{let o=[...p.values()],a=v(o[0]),l=v(o[1]),y=B(a,l),U=j(a,l);p.set(t.pointerId,n),o=[...p.values()],a=v(o[0]),l=v(o[1]);let X=B(a,l),V=j(a,l),_=G(X,y);k(_);let $=V/U;O(X,$);break}}}function H(t){t.preventDefault(),t.stopPropagation();let n=z(t),o=Math.exp(-t.deltaY/512);O(v(n),o)}function k(t){r.translate(t.x,t.y),S()}function O(t,n){function o(l){r.translate(t.x,t.y),r.scale(l,l),r.translate(-t.x,-t.y)}o(n);let a=r.getTransform();a.a<f&&o(f/a.a),a.a>T&&o(T/a.a),x=t,I()}function z(t){return{x:t.offsetX*h,y:t.offsetY*h}}function v(t){return r.getTransform().inverse().transformPoint(t)}function I(){c||(c=u(C))}function C(t){r.save(),r.resetTransform(),r.clearRect(0,0,e.width,e.height),r.restore();let n=F(r,t,x),o=Math.abs(i.vx)>K||Math.abs(i.vy)>K;if(o){let a=t-i.ts,l=i.vx*a,y=i.vy*a;k({x:l,y}),i.vx*=R,i.vy*=R,i.ts=t}o||n?c=u(C):c=0}let M={passive:!0};return e.addEventListener("pointerdown",q,M),e.addEventListener("pointerup",b,M),e.addEventListener("pointercancel",b,M),e.addEventListener("pointermove",D,M),e.addEventListener("wheel",H),{update(t){W(t)},destroy(){N.destroy(),e.removeEventListener("pointerdown",q),e.removeEventListener("pointerup",b),e.removeEventListener("pointercancel",b),e.removeEventListener("pointermove",D),e.removeEventListener("wheel",H)}}}export{et as t};
