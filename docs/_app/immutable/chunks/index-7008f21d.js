var L=new WeakMap,u;function B(e,r){return u=u||new ResizeObserver(a=>{for(let n of a){let h=L.get(n.target);h&&h(n)}}),L.set(e,r),u.observe(e),{destroy(){u.unobserve(e),L.delete(e)}}}var z=(e,r)=>Math.hypot(e.x-r.x,e.y-r.y),W=(e,r)=>({x:(e.x+r.x)/2,y:(e.y+r.y)/2}),Y=(e,r)=>({x:e.x-r.x,y:e.y-r.y});function _(e,r){let a=window.devicePixelRatio,n=e.getContext("2d"),h,g,x,I,v,m,w=e.width=e.clientWidth*a,y=e.height=e.clientHeight*a;function P(t){({width:g,height:x,render:I,padding:v,maxZoom:m}={padding:0,maxZoom:16,...t}),h=Math.min(e.width/(g+v*a),e.height/(x+v*a)),n.resetTransform(),n.translate(e.width/2,e.height/2),n.scale(h,h),n.translate(-g/2,-x/2),f()}P(r);let Z=B(e,t=>{let s=t.contentRect,i=l({x:w/2,y:y/2}),o=n.getTransform();w=s.width*a,y=s.height*a,e.width=w,e.height=y,h=Math.min(e.width/(r.width+v*a),e.height/(r.height+v*a)),n.setTransform(o);let d=l({x:e.width/2,y:e.height/2});n.translate(d.x-i.x,d.y-i.y),f()}),p=new Map;function M(t){t.stopPropagation(),e.setPointerCapture(t.pointerId);let s=E(t);p.set(t.pointerId,s)}function c(t){t.stopPropagation(),e.releasePointerCapture(t.pointerId),p.delete(t.pointerId)}function T(t){if(t.stopPropagation(),!p.has(t.pointerId))return;let s=E(t);switch(p.size){case 1:{let i=p.get(t.pointerId),o=Y(l(s),l(i));R(o),f(),p.set(t.pointerId,s);break}case 2:{let i=[...p.values()],o=l(i[0]),d=l(i[1]),D=W(o,d),H=z(o,d);p.set(t.pointerId,s),i=[...p.values()],o=l(i[0]),d=l(i[1]);let C=W(o,d),O=z(o,d),X=Y(C,D);R(X);let A=O/H;k(C,A);break}}}function b(t){t.preventDefault(),t.stopPropagation();let s=E(t),i=Math.exp(-t.deltaY/512);k(l(s),i)}function R(t){n.translate(t.x,t.y)}function k(t,s){function i(d){n.translate(t.x,t.y),n.scale(d,d),n.translate(-t.x,-t.y)}i(s);let o=n.getTransform();o.a<h&&i(h/o.a),o.a>m&&i(m/o.a),f()}function E(t){return{x:t.offsetX*a,y:t.offsetY*a}}function l(t){return n.getTransform().inverse().transformPoint(t)}function f(){n.save(),n.resetTransform(),n.clearRect(0,0,e.width,e.height),n.restore(),I(n)}return e.addEventListener("pointerdown",M,{passive:!0}),e.addEventListener("pointerup",c,{passive:!0}),e.addEventListener("pointercancel",c,{passive:!0}),e.addEventListener("pointermove",T,{passive:!0}),e.addEventListener("wheel",b),{update(t){P(t)},destroy(){Z.destroy(),e.removeEventListener("pointerdown",M),e.removeEventListener("pointerup",c),e.removeEventListener("pointercancel",c),e.removeEventListener("pointermove",T),e.removeEventListener("wheel",b)}}}export{_ as X};
